limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
#EVENT 2
t1 <- ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 2),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
t2 <- ggplot()+
# geom_point(aes(x= dt, y = Ev_yld_norm, group = site, colour = site),
#            data = SF_event%>%filter(Event == 2)) +
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 2))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
t3 <- ggplot()+
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 2) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
t1+ t2 +t3 + plot_layout(ncol=1)
#EVENT 2
t1 <- ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 2),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
t2 <- ggplot()+
geom_point(aes(x= dt, y = Ev_yld_norm, group = site, colour = site),
data = SF_event%>%filter(Event == 2)) +
# geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
#            data = SF_rec%>%filter(Event == 2))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
t3 <- ggplot()+
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 2) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
t1+ t2 +t3 + plot_layout(ncol=1)
p1 <- ggplot()+
geom_point(mapping=aes(x=dt, y = Ev_yld_norm, group = site, colour = site),
data = TF_event%>%filter(Event == 2)) +
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
p2 <- ggplot()+
geom_point(mapping=aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = TF_rec%>%filter(Event == 2) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
p1+ p2 + plot_layout(ncol=1)
t + p + plot_layout(ncol=1)
View(ppt_events_r7)
ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 2),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 07:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 07:30:00 EST")
)
)
ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 3),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 07:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 07:30:00 EST")
)
)
ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 3),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 07:30:00 EST")
)
)
ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 3),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
ggplot()+
geom_point(aes(x=dt, y = SF_yield,group = stemflow, colour = stemflow),
data = SF_event%>%filter(Event == 3)) +
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
ggplot()+
geom_point(aes(x= dt, y = Ev_yld_norm, group = site, colour = site),
data = SF_event%>%filter(Event == 3))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
ggplot()+
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-03 13:30:00 EST"),
as.POSIXct("2018-09-04 13:30:00 EST")
)
)
ggplot()+
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-10 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-10 17:30:00 EST")
)
)
ggplot()+
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
t1 <- ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 3),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
t2 <- ggplot()+
geom_point(aes(x= dt, y = Ev_yld_norm, group = site, colour = site),
data = SF_event%>%filter(Event == 3))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
t3 <- ggplot()+
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
t1+ t2 +t3 + plot_layout(ncol=1)
ggplot()+
geom_point(mapping=aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = TF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
ggplot()+
geom_point(mapping=aes(x=dt, y = Ev_yld_norm, group = site, colour = site),
data = TF_event%>%filter(Event == 3)) +
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
p1+ p2 + plot_layout(ncol=1)
p1 <- ggplot()+
geom_point(mapping=aes(x=dt, y = Ev_yld_norm, group = site, colour = site),
data = TF_event%>%filter(Event == 3)) +
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
p2 <- ggplot()+
geom_point(mapping=aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = TF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
p <- p1+ p2 + plot_layout(ncol=1)
t + p + plot_layout(ncol=1)
t1 <- ggplot()+
geom_bar(aes(x= dt, y= W9_Precipitation_mm),
data =ppt_events_r7_2%>%filter(Event == 3),stat='identity', colour = alpha( 'green', 0.7))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
t2 <- ggplot()+
geom_point(aes(x= dt, y = Ev_yld_norm, group = site, colour = site),
data = SF_event%>%filter(Event == 3))+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
t3 <- ggplot()+
geom_point(aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = SF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
t <- t1+ t2 +t3 + plot_layout(ncol=1)
ggsave(filename = "Fig_2_ev_3.png", plot = t, path = paste0(here, "/output/figs/"),
device = "png")
p1 <- ggplot()+
geom_point(mapping=aes(x=dt, y = Ev_yld_norm, group = site, colour = site),
data = TF_event%>%filter(Event == 3)) +
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
p2 <- ggplot()+
geom_point(mapping=aes(x= dt, y = Rec_yld_norm, group = site, colour = site),
data = TF_rec%>%filter(Event == 3) )+
scale_x_datetime(
breaks = seq(as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST"), "3 hours"),
labels = date_format("%d-%b\n%H:%M", tz = "EST"),
expand = c(0, 0),
limits = c(
as.POSIXct("2018-09-10 17:30:00 EST"),
as.POSIXct("2018-09-11 17:30:00 EST")
)
)
p <- p1+ p2 + plot_layout(ncol=1)
f = t + p + plot_layout(ncol=1)
t + p + plot_layout(ncol=1)
library(here)
here <- here()
here
library(tidyverse)
library(lubridate)
library(fs)
library(xts)
library(dygraphs)
library(readxl)
# library(ggplot2)
library(scales)
library(patchwork)
library(broom)
ppt_events <-readr::read_csv(paste0(here,  "/output/ppt_events.csv"))%>%
select(datetime_EST2, W9_Precipitation_mm, Event)%>%
mutate(across(.cols = lubridate::is.POSIXct,
~ lubridate::force_tz(., tzone='EST')))
tz(ppt_events$datetime_EST2)
rec_values <- read_csv(paste0(here, "/data/rec_values.csv"))%>%
mutate(across(.cols = lubridate::is.POSIXct,
~ lubridate::with_tz(., tzone='EST')))%>%
rename("rec_yield" = "yield_mm")
rec_intervals <- read_csv(paste0(here, "/data/curve_intervals.csv"))%>%
select(-notes)%>%
mutate(across(.cols = lubridate::is.POSIXct,
~ lubridate::with_tz(., tzone='EST')))%>%
rename("hobo_event_n" = "event_n")%>%
drop_na()
rec_model <- read_csv(paste0(here, "/data/rec_model.csv"))%>%
mutate(across(.cols = lubridate::is.POSIXct,
~ lubridate::with_tz(., tzone='EST')))%>%
mutate(site = recession_n)%>%
mutate(site = case_when(str_detect(site, "SFA") ~ "SF-A",
str_detect(site, "SFB") ~ "SF-B",
str_detect(site, "SFC") ~ "SF-C",
str_detect(site, "SFD") ~ "SF-D",
str_detect(site, "TFB") ~ "TF-B",
str_detect(site, "TFD") ~ "TF-D"))%>%
ungroup()%>%
select(recession_n, hobo_event_n, site, i, m)
merged_rec <- full_join(rec_values, rec_intervals,
by = c( "recession_n", "hobo_event_n", "site"))
centroid1<-ppt_events %>%
drop_na%>%
group_by(Event)%>%
mutate(midpoint = sum(W9_Precipitation_mm)/2)%>%
mutate(cum_ppt = cumsum(W9_Precipitation_mm))%>%
filter(cum_ppt > midpoint)%>%
mutate(centroid1 = min(cum_ppt))%>%
filter(cum_ppt == centroid1)
centroid2<-ppt_events %>%
drop_na%>%
group_by(Event)%>%
mutate(midpoint = sum(W9_Precipitation_mm)/2)%>%
mutate(cum_ppt = cumsum(W9_Precipitation_mm))%>%
filter(cum_ppt < midpoint)%>%
mutate(centroid2 = max(cum_ppt))%>%
filter(cum_ppt == centroid2)
centroid <- full_join(centroid1, centroid2,
by = c( "Event", "cum_ppt", "datetime_EST2", "midpoint",
"W9_Precipitation_mm"))%>%
group_by(Event)%>%
mutate(centroid = median(datetime_EST2))%>%
rename("hobo_event_n" = "Event")%>%
ungroup()
View(centroid1)
View(centroid2)
View(centroid)
library(here)
here <- here()
here
library(tidyverse)
library(lubridate)
library(fs)
library(xts)
library(dygraphs)
library(readxl)
# library(ggplot2)
library(scales)
library(patchwork)
library(broom)
rec_table_1 <- readr::read_csv(paste0(here, "/output/table1.csv"))%>%
rename("hobo_event_n" = "Event")
rec_table_2 <- readr::read_csv(paste0(here, "/output/table2.csv"))
event_table <- readr::read_csv(paste0(here, "/data/event_model.csv"))
merged_event_table <- full_join(rec_table_1, event_table,
by = c( "hobo_event_n"))%>%
select(hobo_event_n, api_30d, event_intensity, m)
merged_rec_table <- full_join(rec_table_1, rec_table_2,
by = c( "hobo_event_n"))%>%
mutate(site = recession_n)%>%
mutate(site = case_when(str_detect(site, "SFA") ~ "SM",
str_detect(site, "SFB") ~ "YB",
str_detect(site, "SFC") ~ "SM",
str_detect(site, "SFD") ~ "YB",
str_detect(site, "TFB") ~ "TF",
str_detect(site, "TFD") ~ "TF"))%>%
select(hobo_event_n, api_30d, event_intensity, m, Delta_T_duration, recession_n, site)
p1 = ggplot(merged_event_table) +
geom_point(mapping = aes(x=api_30d, y=m,colour = "api"))
p2 = ggplot(merged_event_table) +
geom_point(mapping = aes(event_intensity, y=m,colour = "event_intensity"))
ggplot(merged_rec_table) +
geom_point(mapping = aes(Delta_T_duration, y=m,colour = site))+
facet_wrap(~ site, scales = "free")
p1 /p2
ggplot(merged_rec_table) +
geom_point(mapping = aes(Delta_T_duration, y=m,colour = site))+
facet_wrap(~ site, scales = "free")
