View(nested_rec_events)
View(nested_rec_events[[12]][[21]])
model_rec_events <- rec_norm %>%
drop_na()%>%
group_by(recession_n)
View(model_rec_events)
model_rec_events <- rec_norm %>%
group_by(recession_n)
model_rec_events <- rec_norm %>%
group_by(site)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .)))
View(model_rec_events)
View(nested_rec_events)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
pull(Pred)
newdat <- data.frame(power_yield = c(0.016458298))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
pull(Pred)
newdat <- data.frame(power_yield = c(0.016458298))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .)))
newdat <- data.frame(power_yield = c(0.016458298))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat)))
newdat <- data.frame(sec_norm = c(0.391126940765587))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat)))
newdat <- data.frame(sec_norm = c(0.391126940765587))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
pull(Pred)
newdat <- data.frame(sec_norm = c(0.391126940765587))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>%
pull(Pred)
newdat <- data.frame(nested_rec_events$sec_norm )
View(newdat)
newdat <- data.frame(nested_rec_events$sec_norm )
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>%
pull(Pred)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .)))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat)))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(nested_rec_events.sec_norm, newdat))) %>%
pull(Pred)
newdat <- as_tibble(nested_rec_events$sec_norm )
newdat <- as_tibble(nested_rec_events$sec_norm )
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>%
pull(Pred)
newdat <- data.frame(nested_rec_events%% select(sec_norm) )
newdat <- data.frame(nested_rec_events%>% select(sec_norm) )
newdat <- data.frame(nested_rec_events%>% select(sec_norm) )
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>%
pull(Pred)
#predict on new data
select(recession_n, Pred) %>%
unnest
newdat <- data.frame(nested_rec_events%>% select(recession_n, sec_norm) )
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>%
pull(Pred)
View(model_rec_events)
newdat <- data.frame(6.91586846018189e-05,0.391126940765587)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>%
pull(Pred)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>%
pull(Pred)%>%
#predict on new data
select(recession_n, Pred) %>%
unnest
newdat <- data.frame(0.391126940765587)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest
newdat <- data.frame(sec_norm= c(0.391126940765587))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
View(newdat)
newdat <- data.frame(sec_norm= 6.91586846018189e-05, 0.391126940765587)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
newdat <- data.frame(sec_norm= 6.91586846018189e-05, 0.391126940765587,0.465161312631834)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
newdat <- data.frame(sec_norm= 0.000691586846018189)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
newdat <- data.frame(sec_norm= c(6.91586846018189e-05,0.391126940765587,0.465161312631834))
newdat <- data.frame(sec_norm= c(6.91586846018189e-05,0.391126940765587,0.465161312631834))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
View(model_rec_events)
newdat <- data.frame(sec_norm= 6.91586846018189e-05,0.391126940765587,0.465161312631834)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
newdat <- data.frame(sec_norm= 6.91586846018189e-05)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm )
View(newdat)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select( Pred) %>%
unnest(cols = c(Pred))
library(here)
here <- here()
here
library(tidyverse)
library(lubridate)
library(fs)
library(xts)
library(dygraphs)
library(readxl)
# library(ggplot2)
library(scales)
library(patchwork)
hobo_rec_events <- read_csv(paste0(here, "/data/rec_values.csv"))
#norm
rec_norm <- hobo_rec_events  %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
yld_mm_norm1 = yield_mm - min(yield_mm),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1),
power_yield = 10^yld_mm_norm2)
#linear models
nested_rec_events <- rec_norm %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
unnest(data) %>%
ungroup() %>%
distinct(across(recession_n), .keep_all = TRUE)
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm[i] ) #use for loop
sec_norm <- unique(nested_rec_events$sec_norm)
sec_norm <- unique(nested_rec_events$sec_norm)
#create an empty dataframe with same headers
newdat <- slice(hobo_events2, 0)
sec_norm <- unique(nested_rec_events$sec_norm)
#create an empty dataframe with same headers
# newdat <- slice(hobo_events2, 0)
for (i in sec_norm) {
rec_n <- nested_rec_events %>% filter(sec_norm == i)
newdat <- data.frame(sec_norm= rec_n[i])
}
newdat <- data.frame(sec_norm= c(0.123)) %>%
slice(newdat, 0)
newdat <- data.frame(sec_norm= c(0.123))
newdat2 <- slice(newdat, 0)
View(newdat2)
sec_norm <- unique(nested_rec_events$sec_norm)
newdat <- data.frame(sec_norm= c(0.123))
newdat2 <- slice(newdat, 0)
for (i in 1:length(nested_rec_events$sec_norm)) {
interval <- nested_rec_events %>%
# filter(sec_norm == nested_rec_events$sec_norm[i]) %>%
mutate(sec_norm = nested_rec_events$sec_norm[i])
mutate(recession_n = nested_rec_events$recession_n[i])
newdat2 <- bind_rows(newdat2, interval)
}
sec_norm <- unique(nested_rec_events$sec_norm)
newdat <- data.frame(sec_norm= c(0.123))
newdat2 <- slice(newdat, 0)
for (i in 1:length(nested_rec_events$sec_norm)) {
interval <- nested_rec_events %>%
# filter(sec_norm == nested_rec_events$sec_norm[i]) %>%
mutate(sec_norm = nested_rec_events$sec_norm[i])%>%
mutate(recession_n = nested_rec_events$recession_n[i])
newdat2 <- bind_rows(newdat2, interval)
}
for (i in 1:length(nested_rec_events$sec_norm)) {
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm[i] ) #use for loop
}
View(newdat)
newdat2 <- bind_rows(newdat2, newdat)
for (i in 1:length(nested_rec_events$recession_n)) {
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm[i] ) #use for loop
newdat2 <- bind_rows(newdat2, newdat)
}
rm(newdat2)
for (i in 1:length(nested_rec_events$recession_n)) {
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm[i] ) #use for loop
newdat2 <- bind_rows(newdat2, newdat)
}
newdat2 <- bind_rows( newdat)
newdat2 <- newdat
for (i in 1:length(nested_rec_events$recession_n)) {
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm[i] ) #use for loop
newdat2 <- newdat
}
for (i in 1:length(nested_rec_events$recession_n)) {
newdat <- data.frame(sec_norm= nested_rec_events$sec_norm[i] ) #use for loop
newdat2 <- newdat
}
View(newdat)
View(newdat2)
View(nested_rec_events)
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm)
View(newdat)
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
pull(Pred)
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
pull(Pred)
View(model_rec_events)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
pull(Pred) %>%
unnest(cols = c(Pred))
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1  = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
for (i in length(nested_rec_events$recession_n)) {
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1[i]  = purrr::map(.x = data, .f = ~ lm(power_yield[i]~ sec_norm[i], data = .))) %>%
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1[i] <-purrr::map(.x = data, .f = ~ lm(power_yield[i]~ sec_norm[i], data = .))) %>%
mutate(Pred[i] <- purrr::map(.x = m1[i], ~ predict(., newdat[i]))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield[i]~ sec_norm[i], data = .))) %>%
mutate(Pred <- purrr::map(.x = m1, ~ predict(., newdat[i]))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
for (i in length(nested_rec_events$recession_n)) {
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred <- purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
}
for (i in length(nested_rec_events$recession_n)) {
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
}
View(nested_rec_events)
View(rec_norm)
View(model_rec_events)
Pred_fin<- as.data.frame(c(0, 1))
View(Pred_fin)
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm)
for (i in length(nested_rec_events$recession_n)) {
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
mutate(Pred_fin[i, ] <- Pred[[i]])
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
}
Pred_fin<- as.data.frame(c(0, 1))
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm)
for (i in length(nested_rec_events$recession_n)) {
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
mutate(Pred_fin[i, ] <- Pred[[i]])%>%
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
}
library(here)
here <- here()
here
library(tidyverse)
library(lubridate)
library(fs)
library(xts)
library(dygraphs)
library(readxl)
# library(ggplot2)
library(scales)
library(patchwork)
hobo_rec_events <- read_csv(paste0(here, "/data/rec_values.csv"))
#norm
rec_norm <- hobo_rec_events  %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
yld_mm_norm1 = yield_mm - min(yield_mm),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1),
power_yield = 10^yld_mm_norm2)
#linear models
nested_rec_events <- rec_norm %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
unnest(data) %>%
ungroup() %>%
distinct(across(recession_n), .keep_all = TRUE)
#Prediction
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm)
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
#Prediction
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm[1])
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
#Prediction
newdat <- data.frame(sec_norm=nested_rec_events$sec_norm[2])
model_rec_events <- rec_norm %>%
dplyr::group_by(recession_n)%>%
nest() %>%
mutate(m1 = purrr::map(.x = data, .f = ~ lm(power_yield~ sec_norm, data = .))) %>%
mutate(Pred = purrr::map(.x = m1, ~ predict(., newdat))) %>% #predict on new data
select(recession_n, Pred) %>%
unnest(cols = c(Pred))
View(model_rec_events)
