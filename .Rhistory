# mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
# mutate(avg_hourly = W9_Precipitation_mm/nobs)%>%
mutate(date = as.POSIXct(date))
monthly_ppt <- daily_ppt%>%
# mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%m"))
monthly_ppt <- daily_ppt%>%
# mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%m"))%>%
rename("month" = 'month <-  format(as.Date(date, format="%d/%m/%Y"),"%m")')
monthly_ppt <- daily_ppt%>%
# mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%m"))%>%
mutate("month" = 'month <-  format(as.Date(date, format="%d/%m/%Y"),"%m")')
monthly_ppt <- daily_ppt%>%
# mutate(date = as.Date(date))%>%
mutate(df$month<- month(mdy(df$date))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
# mutate(date = as.Date(date))%>%
mutate(month<- month(mdy(date)))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month<- month(mdy(date)))
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%m")))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()
View(monthly_ppt)
View(monthly_ppt[[2]][[1]])
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
# group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()
View(monthly_ppt)
View(monthly_ppt[[1]][[1]])
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
# mutate(avg_hourly = W9_Precipitation_mm/nobs)%>%
mutate(date = as.POSIXct(date))
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data)
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))
View(monthly_ppt)
View(monthly_ppt[[2]][[2]])
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
# mutate(avg_hourly = W9_Precipitation_mm/nobs)%>%
mutate(date = as.POSIXct(date))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by((month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(date = as.POSIXct(month <-  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m")))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(date = as.POSIXct(month))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(date = as.POSIXct.character(month))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(date = as.POSIXct(as.character(month)))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
# mutate(date = as.POSIXct(as.character(month)))
monthly_ppt_api <- monthly_ppt %>%
mutate(api_1d = getApi(W9_Precipitation_mm, k = 0.9, n=1, finite = TRUE),
api_10d = getApi(W9_Precipitation_mm, k = 0.9, n = 10, finite = TRUE),
api_30d = getApi(W9_Precipitation_mm, k = 0.9, n = 30, finite = TRUE),
api_inf = getApi(W9_Precipitation_mm, k = 0.9, finite = FALSE))
View(monthly_ppt)
monthly_ppt_api <- monthly_ppt %>%
mutate(api_1m = getApi(W9_Precipitation_mm, k = 0.9, n=1, finite = TRUE),
api_inf = getApi(W9_Precipitation_mm, k = 0.9, finite = FALSE))
View(monthly_ppt_api)
API_monthly_events <- slice(monthly_ppt_api, 0)
for (i in 1:length(curve_intervals2$event_n)) {
interval <- monthly_ppt_api %>%
filter(date%within% curve_intervals2$datetime_interval_EST[i]) %>%
mutate(event_n = curve_intervals2$event_n[i])%>%
mutate(recession_n = curve_intervals2$recession_n[i])
API_monthly_events  <- bind_rows(API_monthly_events , interval)
}
API_monthly_events <- slice(monthly_ppt_api, 0)
for (i in 1:length(curve_intervals2$event_n)) {
interval <- monthly_ppt_api %>%
filter(month%within% curve_intervals2$datetime_interval_EST[i]) %>%
mutate(event_n = curve_intervals2$event_n[i])%>%
mutate(recession_n = curve_intervals2$recession_n[i])
API_monthly_events  <- bind_rows(API_monthly_events , interval)
}
View(monthly_ppt_api)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
mutate(date = as.POSIXct(month,format="%Y-%m"))
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(date = as.POSIXct(month,format="%Y-%m"))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(month = as.POSIXct(month,format="%Y-%m"))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(month = strptime(month,format="%Y-%m"))
View(monthly_ppt_api)
monthly_ppt_api <- monthly_ppt %>%
mutate(api_1m = getApi(W9_Precipitation_mm, k = 0.9, n=1, finite = TRUE),
api_inf = getApi(W9_Precipitation_mm, k = 0.9, finite = FALSE))
API_monthly_events <- slice(monthly_ppt_api, 0)
for (i in 1:length(curve_intervals2$event_n)) {
interval <- monthly_ppt_api %>%
filter(month%within% curve_intervals2$datetime_interval_EST[i]) %>%
mutate(event_n = curve_intervals2$event_n[i])%>%
mutate(recession_n = curve_intervals2$recession_n[i])
API_monthly_events  <- bind_rows(API_monthly_events , interval)
}
View(API_monthly_events)
Avg_API_hourly<- API_events%>%
mutate(avg_api_hourly = api_1d/nobs)
daily_api_longer <- daily_ppt_api%>%
select(-W9_Precipitation_mm)%>%
pivot_longer(cols = c("api_1d","api_10d","api_30d","api_inf") , names_to = "API",
values_to = "Value")%>%
drop_na()
API_events <- slice(daily_ppt_api, 0)
for (i in 1:length(curve_intervals2$event_n)) {
interval <- daily_ppt_api %>%
filter(date%within% curve_intervals2$datetime_interval_EST[i]) %>%
mutate(event_n = curve_intervals2$event_n[i])%>%
mutate(recession_n = curve_intervals2$recession_n[i])
API_events  <- bind_rows(API_events , interval)
}
Avg_API_hourly<- API_events%>%
mutate(avg_api_hourly = api_1d/nobs)
ggplot(daily_ppt_api) +
geom_line(mapping = aes(x=date, y=api_1d)) +
geom_line(mapping = aes(x=date, y=api_10d), color = "blue") +
geom_line(mapping = aes(x=date, y=api_30d), color = "green") +
geom_line(mapping = aes(x=date, y=api_inf), color = "red")
ggplot(API_events) +
geom_line(mapping = aes(x=date, y=api_1d)) +
geom_line(mapping = aes(x=date, y=api_10d), color = "blue") +
geom_line(mapping = aes(x=date, y=api_30d), color = "green") +
geom_line(mapping = aes(x=date, y=api_inf), color = "red")
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(month = strptime(month,format="%Y-%m"))
sapply(monthly_ppt, class)
monthly_ppt_api <- monthly_ppt %>%
mutate(api_1m = getApi(W9_Precipitation_mm, k = 0.9, n=1, finite = TRUE),
api_inf = getApi(W9_Precipitation_mm, k = 0.9, finite = FALSE))
# API_monthly_events <- slice(monthly_ppt_api, 0)
#
# for (i in 1:length(curve_intervals2$event_n)) {
#   interval <- monthly_ppt_api %>%
#     filter(month%within% curve_intervals2$datetime_interval_EST[i]) %>%
#     mutate(event_n = curve_intervals2$event_n[i])%>%
#     mutate(recession_n = curve_intervals2$recession_n[i])
#
#   API_monthly_events  <- bind_rows(API_monthly_events , interval)
# }
Avg_API_daily<- monthly_ppt_api%>%
mutate(avg_api_1m_daily = api_1m/nobs)
View(Avg_API_daily)
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(month = strptime(month,format="%Y-%m"))
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()%>%
mutate(month = strptime(month,format="%Y-%m"))
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
mutate(month = as.POSIXct(month))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)
sapply(monthly_ppt, class)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
# mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)
sapply(monthly_ppt, class)
View(monthly_ppt)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
# mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
mutate(month = strptime(month,format="%Y-%m"))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(date, format="%d/%m/%Y"),"%Y-%m")
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
mutate(month = as.POSIXct(month))
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
# mutate(month = as.POSIXct(month))
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
sapply(monthly_ppt, class)
monthly_ppt_api <- monthly_ppt %>%
mutate(api_1m = getApi(W9_Precipitation_mm, k = 0.9, n=1, finite = TRUE),
api_inf = getApi(W9_Precipitation_mm, k = 0.9, finite = FALSE))
Avg_API_daily<- monthly_ppt_api%>%
mutate(avg_api_1m_daily = api_1m/nobs)
View(Avg_API_daily)
monthly_ppt <- daily_ppt%>%
select(-nobs)%>%
mutate(date = as.Date(date))%>%
mutate(month =  format(as.Date(date, format="%d/%m/%Y"),"%Y-%m"))%>%
group_by(month)%>%
nest()%>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(data = map(data, ~summarise(.x, across(where(is.numeric), sum))))%>%
unnest_wider(data) %>%
ungroup()
# mutate(month = strptime(month,format="%Y-%m"))
sapply(monthly_ppt, class)
sapply(monthly_ppt, class)
monthly_ppt_api <- monthly_ppt %>%
mutate(api_1m = getApi(W9_Precipitation_mm, k = 0.9, n=1, finite = TRUE),
api_inf = getApi(W9_Precipitation_mm, k = 0.9, finite = FALSE))
ggplot(monthly_ppt_api) +
geom_line(mapping = aes(x=date, y=api_1m)) +
geom_line(mapping = aes(x=date, y=api_inf), color = "red")
ggplot(monthly_ppt_api) +
geom_line(mapping = aes(x=month, y=api_1m)) +
geom_line(mapping = aes(x=month, y=api_inf), color = "red")
