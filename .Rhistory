hourly_ppt_events <- bind_rows(hourly_ppt_events, interval)
}
#models
hobo_events_new2 <- hobo_events_new %>%
mutate(time = as.numeric(dt))%>%
mutate(power_yield = 10^yield_mm)
hobo_events_new2[c('power_yield')][sapply(hobo_events_new2[c('power_yield')], is.infinite)] <- NA
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))%>%
mutate(r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$time,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ time, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ time, data = .)$coefficients[[1]]),
r2 = r^2) %>%
unnest(data)%>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
ggplot(nested_hobo_events) + geom_jitter(mapping = aes(x=as.factor(hobo_event_n) , y= m, colour = site))
all_events<-inner_join(ppt_daily_api_events, nested_hobo_events,
by = c( "recession_n")) %>%
group_by(recession_n, dt_interval)%>%
mutate(event_dur_num = as.numeric(dt_interval),units="secs")%>% ##24hrs event
mutate(event_intensity = W9_Precipitation_mm/event_dur_num) %>%
ungroup() %>%
group_by(event_n) %>%
mutate(cv = sd(m) / mean(m) * 100) %>%
ungroup()
sapply(all_events, class)
t1 <-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_1d, colour = site))
t2 <-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_10d, colour = site))
t3<-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_30d, colour = site))
t4<-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_inf, colour = site))
all_events2<- inner_join(hourly_ppt_events, hobo_events_new,
by = c( "recession_n"))%>%
group_by(site)%>%
mutate(yield_norm = yield_mm + abs(min(yield_mm)))%>%
ungroup()
event8a <- all_events2%>%
# filter(!str_detect(site, "TF"))%>%
filter(event_n == 8)%>%
pivot_wider(names_from = "site", values_from = "yield_norm")%>%
pivot_longer(cols = c("SF-A","SF-C") , names_to = "Sugar_Maple",
values_to = "SM_yield")%>%
pivot_longer(cols = c("SF-B", "SF-D") , names_to = "Yellow_Birch",
values_to = "YB_yield")%>%
pivot_longer(cols = c("SM_yield","YB_yield") , names_to = "stemflow",
values_to = "SF_yield")%>%
pivot_longer(cols = c("TF-B","TF-D") , names_to = "Throughfall",
values_to = "TF_yield")%>%
distinct(SF_yield,TF_yield, .keep_all = TRUE)
event8b <- event8a%>%
pivot_longer(cols = c("SF_yield","TF_yield") , names_to = "Flowpath",
values_to = "flowpath_yield")%>%
distinct(flowpath_yield, .keep_all = TRUE)
event8 <-inner_join(event8a,event8b,
by = c( "recession_n", "datetime_EST","datetime_EST2","dt",
"W9_Precipitation_mm","event_n", "yield_mm",
"Sugar_Maple", "Yellow_Birch", "stemflow",
"Throughfall","hobo_event_n"))
ev8_ppt <-ggplot(event8, mapping = aes(x= datetime_EST2, y= W9_Precipitation_mm))+
# geom_point()
geom_bar(stat='identity')
ev8_hobo_FP <-ggplot(event8, mapping = aes(x= datetime_EST2 , y= flowpath_yield,
color=Flowpath))+
geom_point()
ev8_hobo_SF <-ggplot(event8, mapping = aes(x= datetime_EST2, y= SF_yield, color=stemflow))+
geom_point()
p1 <- ev8_ppt+ ev8_hobo_FP + ev8_hobo_SF + plot_layout(ncol=1)
p1
ev8_ppt <-ggplot(event8, mapping = aes(x= dt, y= W9_Precipitation_mm))+
# geom_point()
geom_bar(stat='identity')
ev8_hobo_FP <-ggplot(event8, mapping = aes(x= dt , y= flowpath_yield,
colour=Flowpath))+
geom_point()
ev8_hobo_SF <-ggplot(event8, mapping = aes(x= dt , y= SF_yield, color=stemflow))+
geom_point()
p2 <- ev8_ppt+ev8_hobo_FP + ev8_hobo_SF + plot_layout(ncol=1)
p2
#models
hobo_events_new2 <- hobo_events_new %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
time = as.numeric(dt))%>%
mutate(power_yield = 10^yield_mm)
View(hobo_events_new2)
#models
hobo_events_new2 <- hobo_events_new %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
power_yield = 10^yield_mm)
#models
hobo_events_new2 <- hobo_events_new %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
yld_mm_norm1 = yield_mm - min(yield_mm),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1),
power_yield = 10^yld_mm_norm2)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x)))
View(nested_hobo_events)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2)
View(nested_hobo_events)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
unnest(data) %>%
ungroup()
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
unnest(data) %>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2)
View(nested_hobo_events[[2]][[1]])
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
unnest(data) %>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
ggplot(nested_hobo_events) +
geom_jitter(mapping = aes(x=as.factor(hobo_event_n) , y= m, colour = site))
all_events<-inner_join(ppt_daily_api_events, nested_hobo_events,
by = c( "recession_n")) %>%
group_by(recession_n, dt_interval)%>%
mutate(event_dur_num = as.numeric(dt_interval), units="secs")
View(all_events)
all_events<-inner_join(ppt_daily_api_events, nested_hobo_events,
by = c( "recession_n")) %>%
group_by(recession_n, dt_interval)%>%
mutate(event_dur_num = seconds(dt_interval), units="secs")
all_events<-inner_join(ppt_daily_api_events, nested_hobo_events,
by = c( "recession_n")) %>%
group_by(recession_n, dt_interval)%>%
mutate(event_dur_num = seconds(dt_interval), units="secs") %>% ##24hrs event
mutate(event_intensity = W9_Precipitation_mm/event_dur_num)
all_events<-inner_join(ppt_daily_api_events, nested_hobo_events,
by = c( "recession_n")) %>%
group_by(recession_n, dt_interval)%>%
mutate(event_dur_num = as.numeric(dt_interval),
units="secs") %>% ##24hrs event
mutate(event_intensity = W9_Precipitation_mm/event_dur_num) %>%
ungroup() %>%
group_by(event_n) %>%
mutate(cv = sd(m) / mean(m) * 100) %>%
ungroup()
t1 <-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_1d, colour = site))
t1
t1 <-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_1d, colour = site))
t2 <-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_10d, colour = site))
t3<-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_30d, colour = site))
t4<-ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_inf, colour = site))
t4
s1 <-ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_1d, colour = site))
s2 <-ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_10d, colour = site))
s3 <-ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_30d, colour = site))
s4 <-ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_inf, colour = site))
s4
a1 <- ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= event_intensity, colour = site))
a2 <- ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= event_intensity, colour = site))
a2
a2 <- ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=m , y= event_intensity, colour = site))
a2
s4 <-ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=m , y= api_inf, colour = site))
s4
s4 <-ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=cv , y= api_inf, colour = site))
a2 <- ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=m , y= event_intensity, colour = site))
a2
a1 <- ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=m , y= event_intensity, colour = site))
a1
p1 <- ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=event_intensity, y= m, colour = site))
p1
p2 <- ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=event_intensity, y= m, colour = site))
p2
ggsave(filename = "ei_m_TF.png", plot = p1, path = paste0(here, "/output/figs/"),
device = "png")
ggsave(filename = "ei_m_SF.png", plot = p2, path = paste0(here, "/output/figs/"),
device = "png")
p1 <- ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=event_intensity, y= m, colour = site)) +
theme_bw()
p1
p2 <- ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=event_intensity, y= m, colour = site)) +
theme_bw()
p2
p1 <- ggplot(all_events %>% filter(str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=event_intensity, y= m, colour = site),
size = 5) +
theme_bw()
p1
p2 <- ggplot(all_events %>% filter(!str_detect(site, "TF"))) +
geom_jitter(mapping = aes(x=event_intensity, y= m, colour = site),
size = 5) +
theme_bw()
p2
ggsave(filename = "ei_m_TF.png", plot = p1, path = paste0(here, "/output/figs/"),
device = "png")
ggsave(filename = "ei_m_SF.png", plot = p2, path = paste0(here, "/output/figs/"),
device = "png")
event8a <- all_events2%>%
# filter(!str_detect(site, "TF"))%>%
filter(event_n == 1)%>%
pivot_wider(names_from = "site", values_from = "yield_norm")%>%
pivot_longer(cols = c("SF-A","SF-C") , names_to = "Sugar_Maple",
values_to = "SM_yield")%>%
pivot_longer(cols = c("SF-B", "SF-D") , names_to = "Yellow_Birch",
values_to = "YB_yield")%>%
pivot_longer(cols = c("SM_yield","YB_yield") , names_to = "stemflow",
values_to = "SF_yield")%>%
pivot_longer(cols = c("TF-B","TF-D") , names_to = "Throughfall",
values_to = "TF_yield")%>%
distinct(SF_yield,TF_yield, .keep_all = TRUE)
all_events2<- inner_join(hourly_ppt_events, hobo_events_new,
by = c( "recession_n"))%>%
group_by(site)%>%
mutate(yield_norm = yield_mm + abs(min(yield_mm)))%>%
ungroup()
event8a <- all_events2%>%
# filter(!str_detect(site, "TF"))%>%
filter(event_n == 1)%>%
pivot_wider(names_from = "site", values_from = "yield_norm")%>%
pivot_longer(cols = c("SF-A","SF-C") , names_to = "Sugar_Maple",
values_to = "SM_yield")%>%
pivot_longer(cols = c("SF-B", "SF-D") , names_to = "Yellow_Birch",
values_to = "YB_yield")%>%
pivot_longer(cols = c("SM_yield","YB_yield") , names_to = "stemflow",
values_to = "SF_yield")%>%
pivot_longer(cols = c("TF-B","TF-D") , names_to = "Throughfall",
values_to = "TF_yield")%>%
distinct(SF_yield,TF_yield, .keep_all = TRUE)
#models
hobo_events_new2 <- hobo_events_new %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
yld_mm_norm1 = yield_mm + abs(min(yield_mm)),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1),
power_yield = 10^yld_mm_norm2)
#models
hobo_events_new2 <- hobo_events_new %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
yld_mm_norm1 = yield_mm - min(yield_mm),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1),
power_yield = 10^yld_mm_norm2)
all_events2<- inner_join(hourly_ppt_events, hobo_events_new,
by = c( "recession_n"))%>%
group_by(site)%>%
mutate(yld_mm_norm1 = yield_mm - min(yield_mm),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1)) %>%
ungroup()
event8a <- all_events2%>%
# filter(!str_detect(site, "TF"))%>%
filter(event_n == 1)%>%
pivot_wider(names_from = "site", values_from = "yield_norm")%>%
pivot_longer(cols = c("SF-A","SF-C") , names_to = "Sugar_Maple",
values_to = "SM_yield")%>%
pivot_longer(cols = c("SF-B", "SF-D") , names_to = "Yellow_Birch",
values_to = "YB_yield")%>%
pivot_longer(cols = c("SM_yield","YB_yield") , names_to = "stemflow",
values_to = "SF_yield")%>%
pivot_longer(cols = c("TF-B","TF-D") , names_to = "Throughfall",
values_to = "TF_yield")%>%
distinct(SF_yield,TF_yield, .keep_all = TRUE)
event8a <- all_events2%>%
# filter(!str_detect(site, "TF"))%>%
filter(event_n == 1)%>%
pivot_wider(names_from = "site", values_from = "yield_mm_norm2")%>%
pivot_longer(cols = c("SF-A","SF-C") , names_to = "Sugar_Maple",
values_to = "SM_yield")%>%
pivot_longer(cols = c("SF-B", "SF-D") , names_to = "Yellow_Birch",
values_to = "YB_yield")%>%
pivot_longer(cols = c("SM_yield","YB_yield") , names_to = "stemflow",
values_to = "SF_yield")%>%
pivot_longer(cols = c("TF-B","TF-D") , names_to = "Throughfall",
values_to = "TF_yield")%>%
distinct(SF_yield,TF_yield, .keep_all = TRUE)
all_events2<- inner_join(hourly_ppt_events, hobo_events_new,
by = c( "recession_n"))%>%
group_by(site)%>%
mutate(yld_mm_norm1 = yield_mm - min(yield_mm),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1)) %>%
ungroup()
event8a <- all_events2%>%
# filter(!str_detect(site, "TF"))%>%
filter(event_n == 1)%>%
pivot_wider(names_from = "site", values_from = "yield_mm_norm2")%>%
pivot_longer(cols = c("SF-A","SF-C") , names_to = "Sugar_Maple",
values_to = "SM_yield")%>%
pivot_longer(cols = c("SF-B", "SF-D") , names_to = "Yellow_Birch",
values_to = "YB_yield")%>%
pivot_longer(cols = c("SM_yield","YB_yield") , names_to = "stemflow",
values_to = "SF_yield")%>%
pivot_longer(cols = c("TF-B","TF-D") , names_to = "Throughfall",
values_to = "TF_yield")%>%
distinct(SF_yield,TF_yield, .keep_all = TRUE)
event8a <- all_events2%>%
# filter(!str_detect(site, "TF"))%>%
filter(event_n == 1)%>%
pivot_wider(names_from = "site", values_from = "yld_mm_norm2")%>%
pivot_longer(cols = c("SF-A","SF-C") , names_to = "Sugar_Maple",
values_to = "SM_yield")%>%
pivot_longer(cols = c("SF-B", "SF-D") , names_to = "Yellow_Birch",
values_to = "YB_yield")%>%
pivot_longer(cols = c("SM_yield","YB_yield") , names_to = "stemflow",
values_to = "SF_yield")%>%
pivot_longer(cols = c("TF-B","TF-D") , names_to = "Throughfall",
values_to = "TF_yield")%>%
distinct(SF_yield,TF_yield, .keep_all = TRUE)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2,
predict = sec_norm*m + i) %>%
unnest(data) %>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
#models
hobo_events_new2 <- hobo_events_new %>%
mutate(sec = seconds(dt) - min(seconds(dt)),
sec_norm = sec/max(sec),
yld_mm_norm1 = yield_mm - min(yield_mm),
yld_mm_norm2 = yld_mm_norm1/max(yld_mm_norm1),
power_yield = 10^yld_mm_norm2)
hobo_events_new2[c('power_yield')][sapply(hobo_events_new2[c('power_yield')], is.infinite)] <- NA
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2,
predict = sec_norm*m + i) %>%
unnest(data) %>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2,
predict = map_dbl(data, ~.$sec_norm*.$m + .$i)) %>%
unnest(data) %>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2,
predict = map_dbl(data, ~.x$sec_norm*.x$m + .x$i)) %>%
unnest(data) %>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
mutate(predict = map_dbl(.x = data, .f= ~.x$sec_norm*.x$m + .x$i)) %>%
unnest(data) %>%
ungroup() %>%
# mutate(cv = sd(m) / mean(m) * 100) %>% #cv is same for all
distinct(across(recession_n), .keep_all = TRUE)
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
mutate(predict = map_dbl(.x = data, .f= ~.x$sec_norm*.x$m + .x$i))
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2)
View(nested_hobo_events)
View(nested_hobo_events[[2]][[1]])
nested_hobo_events <- hobo_events_new2 %>%
drop_na()%>%
group_by(recession_n) %>%
nest() %>%
mutate(nobs = map_dbl(.x = data, .f = ~nrow(.x))) %>%
mutate(mod = map(data, ~lm(power_yield ~ sec_norm, data= .)),
r = map_dbl(.x = data, .f = ~cor(y=(.x$power_yield), x = .x$sec_norm,
use = "na.or.complete")),
m = map_dbl(data, ~lm(power_yield~ sec_norm, data = .)$coefficients[[2]]),
i = map_dbl(data, ~lm(power_yield ~ sec_norm, data = .)$coefficients[[1]]),
r2 = r^2) %>%
unnest(data) %>%
ungroup()
